# Design a Parking Lot

![image-20220309232457051](https://raw.githubusercontent.com/TWDH/Leetcode-From-Zero/pictures/img/image-20220309232457051.png)

![Parking Lot](https://raw.githubusercontent.com/TWDH/Leetcode-From-Zero/pictures/img/a - 副本.png)

# Code

#### *Enums and Constants:*

- Here are the required enums, data types, and constants:

- ```java
  public enum VehicleType {
      CAR, TRUCK, ELECTRIC, VAN, MOTORBIKE
  }
  
  public enum ParkingSpotType {
      HANDICAPPED, COMPACT, LARGE, MOTORBIKE, ELECTRIC
  }
  
  public enum AccountStatus {
      ACTIVE, BLOCKED, BANNED, COMPROMISED, ARCHIVED, UNKNOWN
  }
  
  public enum ParkingTicketStatus {
      ACTIVE, PAID, LOST
  }
  
  public class Address {
      private String streetAddress;
      private String city;
      private String state;
      private String zipCode;
      private String country;
  }
  
  public class Person {
      private String name;
      private Address address;
      private String email;
      private String phone;
  }
  ```

#### *Account, Admin, and ParkingAttendant:*

- These classes represent various people that interact with our system

- ```java
  public abstract class Account {
      private String userName;
      private String password;
      private AccountStatus status;
      private Person person;
  
      public boolean resetPassword();
  }
  ```

- ```java
  public class Admin extends Account {
      public bool addParkingFloor(ParkingFloor floor);
      public bool addParkingSpot(String floorName, ParkingSpot spot);
      public bool addParkingDisplayBoard(String floorName, ParkingDisplayBoard displayBoard);
      public bool addCustomerInfoPanel(String floorName, CustomerInfoPanel infoPanel);
  
      public bool addEntrancePanel(EntrancePanel entrancePanel);
      public bool addExitPanel(ExitPanel exitPanel);
  }
  ```

- ```java
  public class ParkingAttendant extends Account {
      public bool processTicket(string TicketNumber);
  }
  ```

#### *ParkingSpot:*

- Here is the definition of ParkingSpot and all of its children classes:

- ```java
  // ParkingSpot
  public abstract class ParkingSpot {
      private String number;
      private boolean free;
      private Vehicle vehicle;
      private final ParkingSpotType type;
  
      public boolean IsFree();
  
  	// 初始化：指定车位类型
      public ParkingSpot(ParkingSpotType type) {
          this.type = type;
      }
  
      // 将当前车位分配车辆
      public boolean assignVehicle(Vehicle vehicle) {
          this.vehicle = vehicle;
          free = false;
      }
  
      // 将车辆移除
      public boolean removeVehicle() {
          this.vehicle = null;
          free = true;
      }
  }
  ```

- ```java
  // ParkingSpot 子类
  public class HandicappedSpot extends ParkingSpot {
    public HandicappedSpot() {
      super(ParkingSpotType.HANDICAPPED);
    }
  }
  
  public class CompactSpot extends ParkingSpot {
    public CompactSpot() {
      super(ParkingSpotType.COMPACT);
    }
  }
  
  public class LargeSpot extends ParkingSpot {
    public LargeSpot() {
      super(ParkingSpotType.LARGE);
    }
  }
  
  public class MotorbikeSpot extends ParkingSpot {
    public MotorbikeSpot() {
      super(ParkingSpotType.MOTORBIKE);
    }
  }
  
  public class ElectricSpot extends ParkingSpot {
    public ElectricSpot() {
      super(ParkingSpotType.ELECTRIC);
    }
  }
  ```

#### *Vehicle:*

- Here is the definition for Vehicle and all of its child classes:

- ```java
  public abstract class Vehicle {
      private String licenseNumber;
      private final VehicleType type;
      private ParkingTicket ticket;
  
      public Vehicle(VehicleType type) {
          this.type = type;
      }
  
      public void assignTicket(ParkingTicket ticket) {
          this.ticket = ticket;
      }
  }
  ```

- ```java
  public class Car extends Vehicle {
      public Car() {
          super(VehicleType.CAR);
      }
  }
  
  public class Van extends Vehicle {
      public Van() {
          super(VehicleType.VAN);
      }
  }
  
  public class Truck extends Vehicle {
      public Truck() {
          super(VehicleType.TRUCK);
      }
  }
  ```

#### *ParkingFloor:* 

- This class encapsulates a parking floor

- ```java
  public class ParkingFloor {
      private String name;
      
      private HashMap<String, HandicappedSpot> handicappedSpots;
      private HashMap<String, CompactSpot> compactSpots;
      private HashMap<String, LargeSpot> largeSpots;
      private HashMap<String, MotorbikeSpot> motorbikeSpots;
      private HashMap<String, ElectricSpot> electricSpots;
      private HashMap<String, CustomerInfoPortal> infoPortals;
      
      private ParkingDisplayBoard displayBoard;
  
      public ParkingFloor(String name) {
          this.name = name;
      }
  
      // 添加车位
      public void addParkingSpot(ParkingSpot spot) {
          switch (spot.getType()) {
              case ParkingSpotType.HANDICAPPED:
                  // <车位编号，spot类>
                  handicappedSpots.put(spot.getNumber(), spot);
                  break;
              case ParkingSpotType.COMPACT:
                  compactSpots.put(spot.getNumber(), spot);
                  break;
              case ParkingSpotType.LARGE:
                  largeSpots.put(spot.getNumber(), spot);
                  break;
              case ParkingSpotType.MOTORBIKE:
                  motorbikeSpots.put(spot.getNumber(), spot);
                  break;
              case ParkingSpotType.ELECTRIC:
                  electricSpots.put(spot.getNumber(), spot);
                  break;
              default:
                  print("Wrong parking spot type!");
          }
      }
  
      // 将车辆分配到车位
      public void assignVehicleToSpot(Vehicle vehicle, ParkingSpot spot) {
          // 分配车位
          spot.assignVehicle(vehicle);
          
          // 为 spot 更新 displayBoard
          switch (spot.getType()) {
              case ParkingSpotType.HANDICAPPED:
                  updateDisplayBoardForHandicapped(spot);
                  break;
              case ParkingSpotType.COMPACT:
                  updateDisplayBoardForCompact(spot);
                  break;
              case ParkingSpotType.LARGE:
                  updateDisplayBoardForLarge(spot);
                  break;
              case ParkingSpotType.MOTORBIKE:
                  updateDisplayBoardForMotorbike(spot);
                  break;
              case ParkingSpotType.ELECTRIC:
                  updateDisplayBoardForElectric(spot);
                  break;
              default:
                  print("Wrong parking spot type!");
          }
      }
  
      // 分配车辆后更新 displayBoard  
      private void updateDisplayBoardForHandicapped(ParkingSpot spot) {
          // 屏幕上空车位的编号 = 我要停车的编号，那么需要找下一个空车位编号
          // displayBoard.HandicappedSpot.number = HandicappedSpot.number
          if (this.displayBoard.getHandicappedFreeSpot().getNumber() == spot.getNumber()) {
              // find another free handicapped parking and assign to displayBoard
              for (String key : handicappedSpots.keySet()) {
                  if (handicappedSpots.get(key).isFree()) {
                      this.displayBoard.setHandicappedFreeSpot(handicappedSpots.get(key));
                  }
              }
            	// 显示下一个空车位编号  
              this.displayBoard.showEmptySpotNumber();
          }
      }
  
      private void updateDisplayBoardForCompact(ParkingSpot spot) {
          if (this.displayBoard.getCompactFreeSpot().getNumber() == spot.getNumber()) {
              // find another free compact parking and assign to displayBoard
              for (String key : compactSpots.keySet()) {
                  if (compactSpots.get(key).isFree()) {
                      this.displayBoard.setCompactFreeSpot(compactSpots.get(key));
                  }
              }
              this.displayBoard.showEmptySpotNumber();
          }
      }
  
      public void freeSpot(ParkingSpot spot) {
          spot.removeVehicle();
          switch (spot.getType()) {
              case ParkingSpotType.HANDICAPPED:
                  freeHandicappedSpotCount++;
                  break;
              case ParkingSpotType.COMPACT:
                  freeCompactSpotCount++;
                  break;
              case ParkingSpotType.LARGE:
                  freeLargeSpotCount++;
                  break;
              case ParkingSpotType.MOTORBIKE:
                  freeMotorbikeSpotCount++;
                  break;
              case ParkingSpotType.ELECTRIC:
                  freeElectricSpotCount++;
                  break;
              default:
                  print("Wrong parking spot type!");
          }
      }
  }
  ```

#### *ParkingDisplayBoard:*

- This class encapsulates a parking display board

- ```java
  public class ParkingDisplayBoard {
      private String id;
      private HandicappedSpot handicappedFreeSpot;
      private CompactSpot compactFreeSpot;
      private LargeSpot largeFreeSpot;
      private MotorbikeSpot motorbikeFreeSpot;
      private ElectricSpot electricFreeSpot;
  
      // 空车位的编号 （依次打印所有车位信息）
      public void showEmptySpotNumber() {
          String message = "";
          if(handicappedFreeSpot.IsFree()){
              message += "Free Handicapped: " + handicappedFreeSpot.getNumber();
          } else {
              message += "Handicapped is full";
          }
          message += System.lineSeparator();
  
          if(compactFreeSpot.IsFree()){
              message += "Free Compact: " + compactFreeSpot.getNumber();
          } else {
              message += "Compact is full";
          }
          message += System.lineSeparator();
  
          if(largeFreeSpot.IsFree()){
              message += "Free Large: " + largeFreeSpot.getNumber();
          } else {
              message += "Large is full";
          }
          message += System.lineSeparator();
  
          if(motorbikeFreeSpot.IsFree()){
              message += "Free Motorbike: " + motorbikeFreeSpot.getNumber();
          } else {
              message += "Motorbike is full";
          }
          message += System.lineSeparator();
  
          if(electricFreeSpot.IsFree()){
              message += "Free Electric: " + electricFreeSpot.getNumber();
          } else {
              message += "Electric is full";
          }
  
          Show(message);
      }
  }
  ```

#### *ParkingLot:*

- Our system will have only one object of this class. This can be enforced by using the [Singleton](https://en.wikipedia.org/wiki/Singleton_pattern) pattern. In software engineering, the singleton pattern is a software design pattern that restricts the instantiation of a class to only one object.

- ```java
  public class ParkingLot {
      private String name;
      private Location address;
      private ParkingRate parkingRate;
  
      private int compactSpotCount;
      private int largeSpotCount;
      private int motorbikeSpotCount;
      private int electricSpotCount;
      private final int maxCompactCount;
      private final int maxLargeCount;
      private final int maxMotorbikeCount;
      private final int maxElectricCount;
  
      private HashMap<String, EntrancePanel> entrancePanels;
      private HashMap<String, ExitPanel> exitPanels;
      private HashMap<String, ParkingFloor> parkingFloors;
  
      // all active parking tickets, identified by their ticketNumber
      private HashMap<String, ParkingTicket> activeTickets;
  
      // singleton ParkingLot to ensure only one object of ParkingLot in the system,
      // all entrance panels will use this object to create new parking ticket: getNewParkingTicket(),
      // similarly exit panels will also use this object to close parking tickets
      private static ParkingLot parkingLot = null;
  
      // private constructor to restrict for singleton
      private ParkingLot() {
          // 1. initialize variables: read name, address and parkingRate from database
          // 2. initialize parking floors: read the parking floor map from database,
          //  this map should tell how many parking spots are there on each floor. This
          //  should also initialize max spot counts too.
          // 3. initialize parking spot counts by reading all active tickets from database
          // 4. initialize entrance and exit panels: read from database
      }
  
      // static method to get the singleton instance of ParkingLot
      public static ParkingLot getInstance() {
          if (parkingLot == null) {
              parkingLot = new ParkingLot();
          }
          return parkingLot;
      }
  
      // note that the following method is 'synchronized' to allow multiple entrances
      // panels to issue a new parking ticket without interfering with each other
      public synchronized ParkingTicket getNewParkingTicket(Vehicle vehicle) throws ParkingFullException {
          if (this.isFull(vehicle.getType())) {
              throw new ParkingFullException();
          }
          ParkingTicket ticket = new ParkingTicket();
          vehicle.assignTicket(ticket);
          ticket.saveInDB();
          // if the ticket is successfully saved in the database, we can increment the parking spot count
          this.incrementSpotCount(vehicle.getType());
          this.activeTickets.put(ticket.getTicketNumber(), ticket);
          return ticket;
      }
  
      public boolean isFull(VehicleType type) {
          // trucks and vans can only be parked in LargeSpot
          if (type == VehicleType.Truck || type == VehicleType.Van) {
              return largeSpotCount >= maxLargeCount;
          }
  
          // motorbikes can only be parked at motorbike spots
          if (type == VehicleType.Motorbike) {
              return motorbikeSpotCount >= maxMotorbikeCount;
          }
  
          // cars can be parked at compact or large spots
          if (type == VehicleType.Car) {
              return (compactSpotCount + largeSpotCount) >= (maxCompactCount + maxLargeCount);
          }
  
          // electric car can be parked at compact, large or electric spots
          return (compactSpotCount + largeSpotCount + electricSpotCount) >= (maxCompactCount + maxLargeCount
                                                                             + maxElectricCount);
      }
  
      // increment the parking spot count based on the vehicle type
      private boolean incrementSpotCount(VehicleType type) {
          if (type == VehicleType.Truck || type == VehicleType.Van) {
              largeSpotCount++;
          } else if (type == VehicleType.Motorbike) {
              motorbikeSpotCount++;
          } else if (type == VehicleType.Car) {
              if (compactSpotCount < maxCompactCount) {
                  compactSpotCount++;
              } else {
                  largeSpotCount++;
              }
          } else { // electric car
              if (electricSpotCount < maxElectricCount) {
                  electricSpotCount++;
              } else if (compactSpotCount < maxCompactCount) {
                  compactSpotCount++;
              } else {
                  largeSpotCount++;
              }
          }
      }
  
      public boolean isFull() {
          for (String key : parkingFloors.keySet()) {
              if (!parkingFloors.get(key).isFull()) {
                  return false;
              }
          }
          return true;
      }
  
      public void addParkingFloor(ParkingFloor floor) {
          /* store in database */ }
  
      public void addEntrancePanel(EntrancePanel entrancePanel) {
          /* store in database */ }
  
      public void addExitPanel(ExitPanel exitPanel) {
          /* store in database */ }
  }
  ```

![image-20220310001130494](https://raw.githubusercontent.com/TWDH/Leetcode-From-Zero/pictures/img/image-20220310001130494.png)





























































































