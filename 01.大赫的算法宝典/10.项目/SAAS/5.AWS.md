# 1. Linux 通用操作

- 查看进程

  - `ps -aux | grep java`

- 结束进程

  - `kill -9 10528`

- 后台运行进程

  - `nohup java -jar ./ottcard-operator-web-4.5.0-prod.jar --server.port=9058 &`
  - `./start`

- 查看日志

  - `tail -n500 ottcard.client.web.2021-12-03.log -f`

- 内存 free   

  - free   用KB为单位展示数据
  - free -m   用MB为单位展示数据
  - free -h   用GB为单位展示数据

- 查看内存

  - top

- 清除缓存 buffer/cache

  - ```shell
    echo "开始清除缓存"
    sync;sync;sync #写入硬盘，防止数据丢失
    sleep 10#延迟10秒
    echo 1 > /proc/sys/vm/drop_caches
    echo 2 > /proc/sys/vm/drop_caches
    echo 3 > /proc/sys/vm/drop_caches
    
    # 创建定时任务
    crontab -e #弹出配置文件
    
    # 添加定时任务执行频率
    #分　 时　 日　 月　 周　 命令
    0 */2 * * * ./cleanCache.sh
    
    # 查看定时任务是否被执行
    cat /var/log/cron | grep cleanCache
    ```

- 传输文件 - 对文件夹授权

  - `sudo chmod 777 文件夹名`

- 添加用户

  - ```shell
    useradd [选项] 用户名
    ```

  - ```
    passwd 用户名
    ```

- [如何在运行 Amazon Linux 2 的 EC2 实例上安装来自 Extras 库的软件包？](https://aws.amazon.com/cn/premiumsupport/knowledge-center/ec2-install-extras-library-software/)

# 2. 连接AWS

1. 右上角“连接”

   - ![image-20220319182407911](https://raw.githubusercontent.com/TWDH/Leetcode-From-Zero/pictures/img/image-20220319182407911.png)

   - > 用户名：ec2-user
     >
     > 公钥：saas.pem

2. 用户名&密码

   > 1. username/password：root/saaspreka
   > 2. username/password: ec2-user/kevin.zhu
   > 3. username/password: manfred.hu/manfred.hu
   > 4. username/password: prekadmin / Ott@preka2022 (后端)
   > 5. username/ password: prekafrond / Ott@front2022 (前端)
   > 6. IP：3.96.137.171
   > 7. 给用户分配权限
   >    - root    ALL=(ALL)       ALL
   >    - prekadmin ALL=(ALL)   ALL
   > 8. 更改文件夹权限
   >    1. 用户：chown prekadmin(用户名) apps(文件夹)
   >    2. 用户组：chgrp -R prekadmin apps
   >    3. 同时修改：chown -R prekadmin:prekadmin apps

3. 重置root密码

   - https://blog.csdn.net/qiange520/article/details/82464188

   - ```shell
     sudo passwd root
     ```

   - > pwd: saaspreka

4. 切换到root帐号

   - ```sh
     su
     ```

5. 编辑 ssh 安全协议

   - https://docs.aws.amazon.com/zh_cn/AWSEC2/latest/UserGuide/authorizing-access-to-an-instance.html#add-rule-authorize-access
   - ![image-20220215194612975](https://raw.githubusercontent.com/TWDH/Leetcode-From-Zero/pictures/img/image-20220215194612975.png)

   

# 3. 安装MySQL

- [How To Install MySQL 8 on Amazon Linux 2](https://techviewleo.com/how-to-install-mysql-8-on-amazon-linux-2/)

> 1. 安装mysql8.0库：
>    1. sudo yum install https://dev.mysql.com/get/mysql80-community-release-el7-5.noarch.rpm
> 2. 查看yum库：
>    1. sudo yum repolist
> 3. 安装
>    1. amazon-linux-extras install epel -y
>    2. sudo yum -y install mysql-community-server
> 4. 开始运行
>    1. sudo systemctl enable --now mysqld
> 5. 查看状态
>    1. systemctl status mysqld
> 6. 获取临时密码
>    1. grep 'temporary password' /var/log/mysqld.log
>    2. j5ZEGRGipq-a
> 7. 初始化
>    1. mysql_secure_installation -p
>    2. 全部选择 “y”
> 8. 如需更改密码
>    1. mysql -uroot -p
>    2. mysql> ALTER USER 'root'@'localhost' IDENTIFIED BY 'MyNewStrongP@ssw0d!';
> 9. The Password Policy is requires:
>    - At least one uppercase letter
>    - At least one lowercase letter
>    - At least one digit
>    - At least one special character
>    - Total password length is at least 8 characters.
> 10. 进入 mysql
>     1. mysql -uroot -p
> 11. 所有ip可以访问
>     1. [Host XXX is not allowed to connect to this MySQL server](https://blog.csdn.net/h985161183/article/details/82218710)
>        1. mysql -u root -p
>        2. use mysql;
>        3. select host from user where user='root';
>        4. update user set host = '%' where user ='root';
>        5. flush privileges;
>     2. allowPublicKeyRetrieval
>        1. ![image-20220319191915632](https://raw.githubusercontent.com/TWDH/Leetcode-From-Zero/pictures/img/image-20220319191915632.png)
> 12. 创建用户
>     1. CREATE USER 'preka_user'@'%' IDENTIFIED BY 'oTT@1123';
>     2. GRANT ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE ON `preka_product_dev`.* TO 'preka_user'@'%';
> 13. 启动
>     1. service mysqld start 
>     2. service mysqld stop 
>     3. service mysqld restart

> 用户名&密码
>
> - username/password：**root **/ **Saas0preka!**
> - username/password：preka_user / oTT@1123
> - IP：3.96.137.171

- ```sql
  GRANT Create role ON *.* TO 'preka_user'@'%';
  GRANT Create user ON *.* TO 'preka_user'@'%';
  GRANT Drop role ON *.* TO 'preka_user'@'%';
  GRANT Event ON *.* TO 'preka_user'@'%';
  GRANT File ON *.* TO 'preka_user'@'%';
  GRANT Process ON *.* TO 'preka_user'@'%';
  GRANT Reload ON *.* TO 'preka_user'@'%';
  GRANT Replication client ON *.* TO 'preka_user'@'%';
  GRANT Replication slave ON *.* TO 'preka_user'@'%';
  GRANT Show databases ON *.* TO 'preka_user'@'%';
  GRANT Super ON *.* TO 'preka_user'@'%';
  GRANT Create tablespace ON *.* TO 'preka_user'@'%';
  GRANT Shutdown ON *.* TO 'preka_user'@'%';
  
  
  GRANT Alter ON preka_prodcut_dev.* TO 'preka_user'@'%';
  GRANT Create ON preka_prodcut_dev.* TO 'preka_user'@'%';
  GRANT Create view ON preka_prodcut_dev.* TO 'preka_user'@'%';
  GRANT Delete ON preka_prodcut_dev.* TO 'preka_user'@'%';
  GRANT Drop ON preka_prodcut_dev.* TO 'preka_user'@'%' WITH GRANT OPTION;
  GRANT Index ON preka_prodcut_dev.* TO 'preka_user'@'%';
  GRANT Insert ON preka_prodcut_dev.* TO 'preka_user'@'%';
  GRANT References ON preka_prodcut_dev.* TO 'preka_user'@'%';
  GRANT Select ON preka_prodcut_dev.* TO 'preka_user'@'%';
  GRANT Show view ON preka_prodcut_dev.* TO 'preka_user'@'%';
  GRANT Trigger ON preka_prodcut_dev.* TO 'preka_user'@'%';
  GRANT Update ON preka_prodcut_dev.* TO 'preka_user'@'%';
  GRANT Create routine ON preka_prodcut_dev.* TO 'preka_user'@'%';
  GRANT Alter routine ON preka_prodcut_dev.* TO 'preka_user'@'%';
  GRANT Create temporary tables ON preka_prodcut_dev.* TO 'preka_user'@'%';
  GRANT Execute ON preka_prodcut_dev.* TO 'preka_user'@'%';
  GRANT Lock tables ON preka_prodcut_dev.* TO 'preka_user'@'%';
  GRANT Grant option ON preka_prodcut_dev.* TO 'preka_user'@'%';
  ```

# 4. 安装 Java

> 1. sudo yum install java-1.8.0-openjdk
> 2. sudo yum install java-1.8.0-openjdk-devel
> 3. java -version
> 4. javac -version

- [How to Install Java 11/8 on Amazon Linux](https://tecadmin.net/install-java-on-amazon-linux/)

# 5.安装 Nacos

> - 下载 tar.gz 包
> - tar -xzvf
> - cd nacos/bin
> - 启动服务
>   - sh startup.sh -m standalone
> - 域名：3.96.137.171:8848/nacos
> - 关闭服务
>   - sh shutdown.sh
> - 查看状态
>   - ps -ef | [grep](https://so.csdn.net/so/search?q=grep&spm=1001.2101.3001.7020) nacos



# 6. 安装 Redis

- [Install and Configure Redis on CentOS 7](https://www.linode.com/docs/guides/install-and-configure-redis-on-centos-7/)

> - 安装
>   - sudo amazon-linux-extras install redis6
> - 启动
>   - sudo systemctl start redis
> - 检查
>   - redis-cli ping
> - 配置
>   - /etc/redis.conf
>     - appendonly yes 
>     - appendfsync everysec
>     - daemonize yes 守护进程
>     - protected-mode no
>     - bind 注释掉
> - 查看状态
>   - ps -aux | grep redis
>   - netstat -lanp | grep 6379

# 7. Nginx

```
https://preka.auth.ca-central-1.amazoncognito.com/oauth2/token&
                       Content-Type='application/x-www-form-urlencoded'&
                       Authorization=Basic MWY3cm9tcTE0ZGlzYzVrbjFoMWRyb2tsbjY6MTlwZWlrdGVzbzcydWFydjZwMjFhampoODByMm9sODFrcnU3cmhoZHVlOG1oMnMzMHMxbA==
                       grant_type=authorization_code&
                       client_id=1f7romq14disc5kn1h1drokln6&
                       code=fe98c132-72b6-4dc5-9dee-d005119104a5&
                       redirect_uri=https://preka.auth.ca-central-1.amazoncognito.com
                       
                       
                       
https://preka.auth.ca-central-1.amazoncognito.com

https://preka.auth.ca-central-1.amazoncognito.com


// JWK
https://cognito-idp.ca-central-1.amazonaws.com/ca-central-1_3dzYKeGY8/.well-known/jwks.json
```
- 

